<!DOCTYPE html>
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <style>
        svg{
            background: #efefef;
        }
        body{
            padding :100px;
        }

        .tooltip {
        position: absolute;
        text-align: center;
        font-size: 0.8em;
        border-radius: 1em;
        padding: 0.8em;
        pointer-events: none;
        background-color: #222;
        color: #fff;
        }

        .country{
            fill:#cccccc;
            stroke: #333333;;
        }
        .selected{
            fill:aquamarine;
        }
        .slidecontainer {
        width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 5px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #4CAF50;
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 25px;
  height: 25px;
  border-radius: 50%;
  background: #4CAF50;
  cursor: pointer;
}

.map{
    /* margin-top: -70px; */
    margin-left: -90px;
}
.slider-position{
    margin-left: -90px;
}

/* select {
  -webkit-appearance: none;
  -moz-appearance: none;
  -ms-appearance: none;
  appearance: none;
  outline: 0;
  box-shadow: none;
  border: 0 !important;
  background: #2c3e50;
  background-image: none;
}
/* Remove IE arrow */
select::-ms-expand {
  display: none;
}
/* Custom Select */
.select {
  position: relative;
  display: flex;
  width: 20em;
  height: 3em;
  line-height: 3;
  background: #2c3e50;
  overflow: hidden;
  border-radius: .25em;
}
select {
  flex: 1;
  padding: 0 .5em;
  color:black;
  cursor: pointer;
}
/* Arrow */
.select::after {
  content: '\25BC';
  position: absolute;
  top: 0;
  right: 0;
  padding: 0 1em;
  background: #34495e;
  cursor: pointer;
  pointer-events: none;
  -webkit-transition: .25s all ease;
  -o-transition: .25s all ease;
  transition: .25s all ease;
}
/* Transition */
.select:hover::after {
  color: #f39c12;
} */

select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  border-radius: 0;
  color: #222;
}

label[for=favcity] {
  position: relative;
  display: block;
  width: 400px;
  overflow: hidden;
  cursor: pointer;
}

label[for=favcity]::after {
  content: ' ';
  position: absolute;
  right: 0;
  top: 0;
  width: 40px;
  height: 100%;
  display: block;
  background: #24d7ea url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOBAMAAAGq7RFVAAAAJ1BMVEX///////////////////////////////////////////////////9Ruv0SAAAADHRSTlMACAoREoKDt7y9zc5qtZoyAAAAcklEQVQIHQXBsQnCUAAFwFOCCKbIABaWERzi1yaFAzmEpHYEC8GUKVQEkbyhvOOkZqdWt0/QYKqLzQeF7dv6y/RLwa2wYtk4Xxxe+t8yd1WuM/rcUc2gYHEeoP02umSgTR50ybBPRuiSZAS6ZAQ4jgCAPyjYJiRH4fymAAAAAElFTkSuQmCC') no-repeat center center;
  pointer-events: none;
}

label[for=favcity] select {
  border: 5px solid #eeeeee;
  background: white;
  padding: 7px 20px 7px 20px;
  width: 100%;
  font-size: 16px;
  font-family: monospace;
  cursor: pointer;
}

label[for=favcity] select::-ms-expand {
    display: none;
}

label[for=favcity] :-moz-any(select) {
  width: 110%;
}

label[for=favcity].ie9 select {
  width: 110%;
}

label[for=favcity] select:focus {
  outline: 1px dotted #A9A9A9;
}



    </style>
    </head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.20/topojson.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <body>
            <h2 class="text-center">World Climate Change</h2>
            <br>
            <!-- <input type="button" class="btn btn-info" value="View Animation" onclick="addInterval()"> -->
           
                    <div class="row">
                      <div class="col-sm">
                            <button type="button" class="btn btn-primary btn-sm" onclick="addInterval()" >Start Animation</button>
                            <button type="button" class="btn btn-danger btn-sm" onclick="StopInterval()" >Stop Animation</button>
                            <label for="favcity">
                                    <select  id="mySelect" name="slct"  onchange="myFunction()">
                                    <option selected value="CO2 emissions (kt)">CO2 emissions</option>
                                    <option value="Methane emissions (kt of CO2 equivalent)">Methane emissions</option>
                                    <option value="Nitrous oxide emissions (thousand metric tons of CO2 equivalent)"> Nitrous oxide emissions</option>
                                    <option value="Total greenhouse gas emissions (kt of CO2 equivalent)">Total greenhouse gas</option>
                                    <option value="Population, total">Total Population</option>
                                    </select>
                                  </label>
                      </div>
                      <div class="col-sm">
                           
                      </div>
                    </div>
            <br>



        <br>
        <div class="slider-position" id="slider-section">
                <p> Year </p>
                <input id="yr" type="range" min="1992" max="2012" step="1" value="1967" class="slider"  style="width: 800px"/>
                <output id = "yrdemo" value="1992">1992</output><br>
        </div>
        <div class="map">
        </div>

       





        <script>

            var year=1992;
            var downDownValue='CO2 emissions (kt)';
             var output_year = document.getElementById("yrdemo");
             var toolTipValue='CO2 emissions (kt)';
             console.log(output_year);
            var yearVisedata={};

           
            var yearAuto=1991;
            function trig() {  
                yearAuto++;
                if(yearAuto>=2012){
                    document.getElementById("yr").style.display="block";
                    return;
                }
                year=yearAuto;
                d3.queue()
                .defer(d3.json,"https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
                    .defer(d3.csv,"concap.csv")
                    .defer(d3.csv,"https://raw.githubusercontent.com/ZeningQu/World-Bank-Data-by-Indicators/master/climate-change/climate-change.csv")
                    .await(ready)
            }
           
            function addInterval(){
                document.getElementById("yr").style.display="none";
                
                var i = setInterval(function() { trig(); }, 200);
            }
            function StopInterval(){
                document.getElementById("yr").style.display="block";
            }

            function changeSlider(){
                console.log("trigger");

            }




            document.getElementById("yr").addEventListener("change", function() {
                output_year.value=this.value;
                year=this.value;
                
            d3.queue()
            .defer(d3.json,"https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
                .defer(d3.csv,"concap.csv")
                .defer(d3.csv,"https://raw.githubusercontent.com/ZeningQu/World-Bank-Data-by-Indicators/master/climate-change/climate-change.csv")
                .await(ready)
            });

            

            function myFunction() {
              
                 downDownValue = document.getElementById("mySelect").value;
                 yearAuto=1991;
              
               console.log(downDownValue);
               if(downDownValue=='CO2 emissions (kt)'){
                toolTipValue='CO2 emissions (kt)';
               }
               else if(downDownValue=='Methane emissions (kt of CO2 equivalent)'){
                toolTipValue='Methane emissions (kt)';
               }
               else if(downDownValue=='Nitrous oxide emissions (thousand metric tons of CO2 equivalent)'){
                toolTipValue='Nitrous oxide emissions (kt)';
               }
               else if(downDownValue=='Population, total'){
                toolTipValue='Total Population ';
               }
               else if(downDownValue=='Total greenhouse gas emissions (kt of CO2 equivalent)'){
                toolTipValue='Total greenhouse (kt)';
               }

               d3.queue()
                .defer(d3.json,"https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
                .defer(d3.csv,"concap.csv")
                .defer(d3.csv,"https://raw.githubusercontent.com/ZeningQu/World-Bank-Data-by-Indicators/master/climate-change/climate-change.csv")
                .await(ready)


            }
            var yearVisedata=[];
            const tooltip = d3.select("body").append("div")
                            .attr("class", "tooltip")
                            .style("opacity", 0);

            var margin = { top: 50, right: 50, bottom: 50, left: 50 },
                width = 800 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;
            
            var svg = d3.select('.map').append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
            
                var projection = d3.geoMercator()
                                .translate([width/2,height/2])
                                .scale(90);

                var path = d3.geoPath()
                            .projection(projection);     

                var f= d3.queue()
                .defer(d3.json,"https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
                .defer(d3.csv,"concap.csv")
                .defer(d3.csv,"https://raw.githubusercontent.com/ZeningQu/World-Bank-Data-by-Indicators/master/climate-change/climate-change.csv")
                .await(ready)

                var yearVisedata=[];    

             function ready(error,topo,dataset,worldBankData){
               
                 var count=0;
                 var maxValueCo2=0;
                 var countries = topo.features;
                 console.log(year);
                 for(var i=0;i<worldBankData.length;i++){
                        if(worldBankData[i].Year==year){
                            if(worldBankData[i][downDownValue]>maxValueCo2){
                                maxValueCo2=worldBankData[i][downDownValue];
                            }
                            count++;
                        }
                    }
                var color =d3.scaleLinear()
                            .domain([3, maxValueCo2])
                            .range(["#eba7ac","#9e242d"]);

                var colorScale = d3.scaleThreshold()
                            .domain([1000, 10000, 100000, 300000, 1000000, 5000000])
                            .range(d3.schemeBlues[7]);


                 svg.selectAll(".country")
                 .data(countries)
                 .enter()
                    .append("path")
                    .attr("d",path)
                    .attr("fill",function(d,i){
                        var t=d.id;
                        var colorValue=null;
                        for(var i=0;i<worldBankData.length;i++){
                            if(worldBankData[i].Year==year){
                                if(worldBankData[i]['Country Code']==t){
                                    colorValue=worldBankData[i][downDownValue];
                                }
                            }
                        }
                        return colorScale(colorValue);
                    })
                    .on('mouseover',function(d){
                         var t=d.id;
                         var hoverData=null;
                         console.log(t);
                            for(var i=0;i<worldBankData.length;i++){
                                 if(worldBankData[i].Year==year){
                                     if(worldBankData[i]['Country Code']==t){
                                     //console.log("yes");
                                     //console.log(worldBankData[i]);
                                     hoverData=worldBankData[i];
                                     //console.log(hoverData);
                                     tooltip
                                    .style("opacity", 0.8)
                                    .html("Name: " + hoverData['Country Name'] +
                                    "<br />"+toolTipValue+" " + hoverData[downDownValue]
                                      )
                                    .style('left', (d3.event.pageX) + 'px')
                                     .style('top', (d3.event.pageY) + 'px');
                                     }
                                    
                                 }
                                 
                            }
                    })
                    .on('mouseout',function(d){
                         d3.select(this).classed("selected",false)
                         d3.select(this)
                         tooltip.style("opacity", 0);
                         
                    });
             }    




            console.log("above");
            console.log("after ");
        
        </script>
    </body>
</html>