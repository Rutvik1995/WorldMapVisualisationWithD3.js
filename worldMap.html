<!DOCTYPE html>
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <style>
        .slidecontainer {
  width: 100%; /* Width of the outside container */
}

/* The slider itself */
.slider {
  -webkit-appearance: none;  /* Override default CSS styles */
  appearance: none;
  width: 100%; /* Full-width */
  height: 25px; /* Specified height */
  background: #d3d3d3; /* Grey background */
  outline: none; /* Remove outline */
  opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
  -webkit-transition: .2s; /* 0.2 seconds transition on hover */
  transition: opacity .2s;
}

/* Mouse-over effects */
.slider:hover {
  opacity: 1; /* Fully shown on mouse-over */
}

/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
.slider::-webkit-slider-thumb {
  -webkit-appearance: none; /* Override default look */
  appearance: none;
  width: 25px; /* Set a specific slider handle width */
  height: 25px; /* Slider handle height */
  background: #4CAF50; /* Green background */
  cursor: pointer; /* Cursor on hover */
}

.slider::-moz-range-thumb {
  width: 25px; /* Set a specific slider handle width */
  height: 25px; /* Slider handle height */
  background: #4CAF50; /* Green background */
  cursor: pointer; /* Cursor on hover */
}
        svg{
            background: #efefef;
        }
        body{
            padding :100px;
        }

        .tooltip {
        position: absolute;
        text-align: center;
        font-size: 0.8em;
        border-radius: 1em;
        padding: 1em;
        pointer-events: none;
        background-color: #222;
        color: #fff;
        }
        .city-label{
         font-size:10px;
        }

        .country{
            fill:#cccccc;
            stroke: #333333;;
        }
        .selected{
            fill:aquamarine;
        }
        </style>
    </head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.20/topojson.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
      <script src="https://d3js.org/topojson.v2.min.js"></script>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        <controls>
<h1> Global Properties </h1>
<p> Year </p>
<input id="yr" type="range" min="1910" max="2019" step="3" value="1910" class="slider" style="width: 160px"/>
<output id = "yrdemo" value="1970"></output><br>
<p>Agricultural Area</P>
<input id="elec" type="range" min="0" max="500" step="5" value="0" class="slider" style="width: 160px"/>
<output id = "elecdemo" value="0"></output><br>
<p> Color </p>
<input id="color" type="color" value="#ffba00">

</controls>

        <script>
        
            var year=1970;
          var elecs=0;
          var output_year = document.getElementById("yrdemo");
          var output_elec = document.getElementById("elecdemo");
            document.getElementById("elec").addEventListener("change", function() {
              output_elec.value=this.value;
              elecs=this.value;
             d3.queue()
                .defer(d3.json,"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
                .defer(d3.csv,"concap.csv")
                .defer(d3.csv,"https://raw.githubusercontent.com/ZeningQu/World-Bank-Data-by-Indicators/master/climate-change/climate-change.csv")
                .await(ready);
              
            });
            document.getElementById("yr").addEventListener("change", function() {
             output_year.value=this.value;
             year=this.value;
            d3.queue()
                .defer(d3.json,"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
                .defer(d3.csv,"concap.csv")
                .defer(d3.csv,"https://raw.githubusercontent.com/ZeningQu/World-Bank-Data-by-Indicators/master/climate-change/climate-change.csv")
                .await(ready);
           
            });
         var yearVisedata=[];
       
            


            const tooltip = d3.select("body").append("div")
                            .attr("class", "tooltip")
                            .style("opacity", 0);



            var margin = { top: 50, right: 50, bottom: 50, left: 50 },
                width = 1000 - margin.left - margin.right,
                height = 1000 - margin.top - margin.bottom;
            
            var svg = d3.select('body').append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
            
           
       
        var projection=d3.geoMercator();
        var path = d3.geoPath().projection(projection);
        
        var f= d3.queue()
                .defer(d3.json,"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
                .defer(d3.csv,"concap.csv")
                .defer(d3.csv,"https://raw.githubusercontent.com/ZeningQu/World-Bank-Data-by-Indicators/master/climate-change/climate-change.csv")
                .await(ready);

             function ready(error,data,dataset,worldBankData){
                 var countries = topojson.feature(data,data.objects.countries).features;
                 var count=0;
                 var maxValueCo2=0;
                 for(var i=0;i<worldBankData.length;i++){
                        //t=Math.abs(worldBankData[i]['Agricultural land (% of land area)']);
                        if(worldBankData[i]['Year']==year && worldBankData[i]['Agricultural land (% of land area)']>=elecs){
                            yearVisedata[count]=worldBankData[i]['CO2 emissions (kt)'];
  
                            if(worldBankData[i]['CO2 emissions (kt)']>maxValueCo2){
                                maxValueCo2=worldBankData[i]['CO2 emissions (kt)'];
                            }
                            count++;
                        }
            
                    }
                var color =d3.scaleLinear()
                            .domain([0, maxValueCo2])
                            .range(["#FF9966","#FF3800"]);


                 svg.selectAll(".country")
                 .data(countries)
                 .enter()
                 .append("path")
                    //.attr("class","country")
                 .attr("d",path)
                  .on('mouseover',function(d){
                         d3.select(this).classed("selected",true)
                    })
                  .on('mouseout',function(d){
                         d3.select(this).classed("selected",false)
                    })
                 .attr("fill",function(d,i){
                      
                     return color(yearVisedata[i]);
                     });
                 

                    svg.selectAll(".city-label")
                    .data(dataset)
                    .enter().append("text")
                    .attr("class","city-label")
                        .attr("x",function(d){
                            var coords = projection([d.CapitalLongitude,d.CapitalLatitude])
                            return coords[0];
                        })
                        .attr("y",function(d){
                           
                            var coords = projection([d.CapitalLongitude,d.CapitalLatitude])
                            return coords[1];
                        });
                       

                    svg.selectAll(".city-circle")
                    .data(dataset)
                    .enter().append("circle")
                        .attr("r",7)
                        .attr("cx",function(d){
                            var coords = projection([d.CapitalLongitude,d.CapitalLatitude])
                            return coords[0];
                        })
                        .attr("cy",function(d){
                           
                            var coords = projection([d.CapitalLongitude,d.CapitalLatitude])
                            return coords[1];
                        })
                        .on('mouseover',function(d,i){
                         console.log(d.CapitalName);
                         d3.select(this)
                            .style("fill", "red")
                            .style("stroke", "red");
                            tooltip
                            .style("opacity", 0.8)
                            .html(
                            "Name: " + d.CapitalName + "<br>" + yearVisedata[i]
                            //  "<br />Mass: " + d.properties.mass +
                           // "<br />Year: " + d.properties.year.slice(0, 4)
                                )
                             .style('left', (d3.event.pageX) + 'px')
                            .style('top', (d3.event.pageY) + 'px');
                        })
                        .on("mouseout", function(d) {
                            d3.select(this)
                        .style("stroke", "black")
                        .style("fill", "black");
                        tooltip.style("opacity", 0);
                     })
                     .transition()
                     .delay(2000)
                     .on("start", function repeat() {
                     d3.active(this)
                     .style("fill", "red")
                     .transition()
                     .style("fill", "green")
                     .transition()
                     .style("fill", "blue")
                     .transition()
                     .on("start", repeat);
                     });
            
              }
             
                         
             
        </script>
    </body>
</html>